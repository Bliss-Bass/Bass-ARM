#!/bin/bash

# Function to display usage information
usage() {
    echo "Usage: $0 --var VARIABLE_NAME --command SHORT_COMMAND --desc DESCRIPTION"
    echo "  --var VARIABLE_NAME     : The name of the build variable to be inserted"
    echo "  --command SHORT_COMMAND : The short command to be added to the displayHelp() function"
    echo "  --desc DESCRIPTION      : The short description to be added to the displayHelp() function"
    exit 1
}

# Check if no arguments are provided, then display usage
if [ "$#" -eq 0 ]; then
    usage
fi

# Parse the command-line arguments
while [[ "$#" -gt 0 ]]; do
    case $1 in
        --var) variable_name="$2"; shift ;;
        --command) command="$2"; shift ;;
        --desc) description="$2"; shift ;;
        *) echo "Unknown parameter passed: $1"; usage ;;
    esac
    shift
done

# Insert the export variable in build-x86.sh
sed -i '/# autogenerated clear exports go here/a export '"$variable_name"'=false' build-x86.sh

# Update the displayHelp() function
sed -i '/# autogenerated help items go here/a \ \ \ \ echo "--'"$command"'          '"$description"'"' build-x86.sh

# Update the build script options
sed -i '/# autogenerated menu items go here/a \ \ \ \ \ \ \ \ --'"$command"')\n\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ '"$variable_name"'=true\n\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ shift\n\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ;;' build-x86.sh

# Update the exports
sed -i '/# autogenerated export items go here/a export '"$variable_name"'=${'"$variable_name"':-false};' build-x86.sh

# Update the echo config statements
formatted_desc=$(echo "$description" | sed 's/[^a-zA-Z0-9]//g')  # Remove spaces and special characters
formatted_desc_camel=$(echo "$formatted_desc" | sed -r 's/(^|_)([a-z])/\U\2/g')  # Convert to camel case
sed -i '/# autogenerated echo items go here/a echo "'"$formatted_desc_camel"': ${'"$variable_name"'}";' build-x86.sh

echo "Build script updated successfully."